import{B as N,q as E,r as f,c as a,a as e,d as C,t as h,F as P,i as M,b as o,w as z,h as G,n as L,u as A,f as l,e as D,m as T,y as q,j as I,D as J,z as K,L as X,J as Z,I as ee,E as V,K as se,x as te,g as O,_ as le}from"./index-CMNtH3MY.js";import{D as R}from"./DashboardClientAssignmentStore-CfOMA2Sf.js";import{L as r}from"./localeText-CMSShcDt.js";const ne={class:"card rounded-0 border-0"},ae={role:"button",class:"ms-auto text-white"},ie={key:0,class:"bi bi-chevron-compact-down"},oe={key:1,class:"bi bi-chevron-compact-up"},re={key:0,class:"card-body p-0"},de={class:"list-group list-group-flush"},ce={key:0},ue={class:"text-body"},me={class:"text-muted"},be={key:1},ve={class:"text-body"},ge={class:"text-muted"},fe=["onClick"],pe=["onClick"],F=N({__name:"availablePeersGroup",props:["configuration","peers","clientAssignedPeers","availablePeerSearchString"],emits:["assign","unassign"],setup(u,{emit:w}){const i=u,v=w,d=R(),g=E(()=>i.clientAssignedPeers&&Object.keys(i.clientAssignedPeers).includes(i.configuration)?i.peers.filter(n=>!i.clientAssignedPeers[i.configuration].map(t=>t.id).includes(n.id)&&(!i.availablePeerSearchString||i.availablePeerSearchString&&(n.id.includes(i.availablePeerSearchString)||n.name.includes(i.availablePeerSearchString)))):i.availablePeerSearchString?i.peers.filter(n=>n.id.includes(i.availablePeerSearchString)||n.name.includes(i.availablePeerSearchString)):i.peers),y=f(!1),p=f(!1);return(n,t)=>{const b=G("RouterLink");return l(),a("div",ne,[e("div",{onClick:t[0]||(t[0]=s=>p.value=!p.value),role:"button",class:"card-header rounded-0 sticky-top bg-body-secondary border-0 border-bottom text-white d-flex"},[e("small",null,[e("samp",null,h(u.configuration),1)]),e("a",ae,[p.value?(l(),a("i",ie)):(l(),a("i",oe))])]),p.value?C("",!0):(l(),a("div",re,[e("div",de,[(l(!0),a(P,null,M(g.value,s=>(l(),a("div",{class:"list-group-item d-flex border-bottom list-group-item-action d-flex align-items-center gap-3",key:s.id},[y.value?(l(),a("div",be,[e("small",ve,[o(r,{t:"Are you sure to remove this peer?"})]),t[2]||(t[2]=e("br",null,null,-1)),e("small",ge,[e("samp",null,h(s.id),1)])])):(l(),a("div",ce,[e("small",ue,[o(b,{class:"text-decoration-none",target:"_blank",to:"/configuration/"+u.configuration+"/peers?id="+encodeURIComponent(s.id)},{default:z(()=>[e("samp",null,h(s.id),1)]),_:2},1032,["to"])]),t[1]||(t[1]=e("br",null,null,-1)),e("small",me,h(s.name?s.name:"Untitled Peer"),1)])),u.clientAssignedPeers?(l(),a("button",{key:2,onClick:m=>v("assign",s.id),class:L([{disabled:A(d).assigning},"btn bg-success-subtle text-success-emphasis ms-auto"])},[...t[3]||(t[3]=[e("i",{class:"bi bi-plus-circle-fill"},null,-1)])],10,fe)):(l(),a("button",{key:3,onClick:m=>v("unassign",s.assignment_id),class:L([{disabled:A(d).unassigning},"btn bg-danger-subtle text-danger-emphasis ms-auto"]),"aria-label":"Delete Assignment"},[...t[4]||(t[4]=[e("i",{class:"bi bi-trash-fill"},null,-1)])],10,pe))]))),128))])]))])}}}),_e={key:0,class:"d-flex rounded-0 border-0 flex-column d-flex flex-column border-bottom pb-1"},he={class:"d-flex flex-column p-3 gap-3"},xe={class:"d-flex align-items-center"},ye={class:"mb-0"},ke={class:"text-bg-primary badge ms-2"},Ce={class:"text-bg-info badge ms-2"},we={class:"rounded-3 availablePeers border h-100 overflow-scroll flex-grow-1 d-flex flex-column"},Pe={key:0,class:"text-muted m-auto p-3"},$e={key:0,style:{height:"500px"},class:"d-flex flex-column p-3"},Se={class:"availablePeers border h-100 card rounded-3"},Ae={class:"card-header sticky-top p-3"},De={class:"mb-0 d-flex align-items-center"},Ie={class:"card-body p-0 overflow-scroll"},Ne={key:0,class:"text-muted m-auto"},Me={class:"card-footer d-flex gap-2 p-3 align-items-center justify-content-end"},Re={key:1},Be=N({__name:"clientAssignedPeers",props:["client","clientAssignedPeers"],emits:["refresh"],setup(u,{emit:w}){const i=u,v=f(!1),d=R(),g=f(!1),y=w,p=async(b,s,m)=>{await d.assignClient(b,s,m,!1),y("refresh")},n=async b=>{await d.unassignClient(void 0,void 0,b),y("refresh")},t=f("");return(b,s)=>(l(),a("div",null,[v.value?(l(),a("div",Re,[...s[6]||(s[6]=[e("div",{class:"p-3 placeholder-glow border-bottom"},[e("h6",{class:"placeholder w-100 rounded-3"}),e("div",{class:"placeholder w-100 rounded-3",style:{height:"400px"}})],-1)])])):(l(),a("div",_e,[e("div",he,[e("div",xe,[e("h6",ye,[o(r,{t:"Assigned Peers"}),e("span",ke,[D(h(Object.keys(u.clientAssignedPeers).length)+" ",1),o(r,{t:Object.keys(u.clientAssignedPeers).length>1?"Configurations":"Configuration"},null,8,["t"])]),e("span",Ce,[D(h(Object.values(u.clientAssignedPeers).flat().length)+" ",1),o(r,{t:Object.values(u.clientAssignedPeers).flat().length>1?"Peers":"Peer"},null,8,["t"])])]),e("button",{class:"btn btn-sm bg-primary-subtle text-primary-emphasis rounded-3 ms-auto",onClick:s[0]||(s[0]=m=>g.value=!g.value)},[g.value?(l(),a(P,{key:1},[s[4]||(s[4]=e("i",{class:"bi bi-check me-2"},null,-1)),o(r,{t:"Done"})],64)):(l(),a(P,{key:0},[s[3]||(s[3]=e("i",{class:"bi bi-list-check me-2"},null,-1)),o(r,{t:"Manage"})],64))])]),e("div",we,[(l(!0),a(P,null,M(u.clientAssignedPeers,(m,k)=>(l(),I(F,{configuration:k,peers:m,onUnassign:s[1]||(s[1]=async _=>await n(_))},null,8,["configuration","peers"]))),256)),Object.keys(u.clientAssignedPeers).length===0?(l(),a("h6",Pe,[o(r,{t:"No peer assigned to this client"})])):C("",!0)])]),g.value?(l(),a("div",$e,[e("div",Se,[e("div",Ae,[e("h6",De,[o(r,{t:"Available Peers"})])]),e("div",Ie,[(l(!0),a(P,null,M(A(d).allConfigurationsPeers,(m,k)=>(l(),I(F,{availablePeerSearchString:t.value,configuration:k,clientAssignedPeers:u.clientAssignedPeers,peers:m,key:k,onAssign:async _=>await p(k,_,i.client.ClientID)},null,8,["availablePeerSearchString","configuration","clientAssignedPeers","peers","onAssign"]))),128)),Object.keys(A(d).allConfigurationsPeers).length===0?(l(),a("h6",Ne,[o(r,{t:"No peer is available to assign"})])):C("",!0)]),e("div",Me,[s[5]||(s[5]=e("label",{for:"availablePeerSearchString"},[e("i",{class:"bi bi-search me-2"})],-1)),T(e("input",{id:"availablePeerSearchString","onUpdate:modelValue":s[2]||(s[2]=m=>t.value=m),class:"form-control form-control-sm rounded-3 w-auto",type:"text"},null,512),[[q,t.value]])])])])):C("",!0)]))]))}}),Ue={class:"p-3 d-flex gap-3 flex-column border-bottom"},je={class:"d-flex align-items-center gap-2"},Le={class:"mb-0"},Ve=N({__name:"clientDelete",props:["client"],emits:["refresh"],setup(u,{emit:w}){const i=u,v=f(!1),d=f(!1),g=w,y=J(),p=async()=>{v.value=!0,await K("/api/clients/deleteClient",{ClientID:i.client.ClientID},n=>{v.value=!1,n.status?(g("deleteSuccess"),y.newMessage("Server","Delete client successfully","success")):y.newMessage("Server","Failed to delete client","danger")})};return(n,t)=>(l(),a("div",Ue,[e("div",je,[e("h6",Le,[d.value?(l(),I(r,{key:1,t:"Are you sure to delete this client?"})):(l(),I(r,{key:0,t:"Delete Client"}))]),d.value?C("",!0):(l(),a("button",{key:0,class:"btn btn-sm bg-danger-subtle text-danger-emphasis rounded-3 ms-auto",onClick:t[0]||(t[0]=b=>d.value=!0)},[t[2]||(t[2]=e("i",{class:"bi bi-trash-fill me-2"},null,-1)),o(r,{t:"Delete"})])),d.value?(l(),a(P,{key:1},[e("button",{onClick:p,class:"btn btn-sm bg-danger-subtle text-danger-emphasis rounded-3 ms-auto"},[t[3]||(t[3]=e("i",{class:"bi bi-trash-fill me-2"},null,-1)),o(r,{t:"Yes"})]),d.value?(l(),a("button",{key:0,class:"btn btn-sm bg-secondary-subtle text-secondary-emphasis rounded-3",onClick:t[1]||(t[1]=b=>d.value=!1)},[t[4]||(t[4]=e("i",{class:"bi bi-x-lg me-2"},null,-1)),o(r,{t:"No"})])):C("",!0)],64)):C("",!0)])]))}}),Oe={class:"p-4 border-bottom bg-body-tertiary z-0"},Fe={class:"mb-3 backLink"},Ee={class:"text-muted"},ze={class:"d-flex flex-column gap-2"},Ge={class:"d-flex align-items-center"},Te={class:"text-muted"},qe={class:"ms-auto"},Je={class:"d-flex align-items-center gap-2"},Ke={class:"text-muted"},We={class:"p-3 border-bottom"},Ye={class:"d-flex justify-content-end align-items-center gap-2 mb-2"},He={class:"text-muted"},Qe=["selected"],Xe=["selected"],Ze={class:"row g-3"},es={class:"col-lg-3"},ss={class:"card rounded-3 h-100"},ts={class:"card-body"},ls={class:"text-muted"},ns={class:"h5 mb-1"},as={class:"h6 text-muted mb-0"},is={class:"small text-muted mt-1"},os={style:{flex:"1 0 0","overflow-y":"scroll"}},rs={key:1,class:"d-flex w-100 h-100 text-muted"},ds={class:"m-auto text-center"},cs=N({__name:"clientViewer",emits:["deleteSuccess"],async setup(u,{emit:w}){let i,v;const d=R(),g=J(),y=X(),p=se(),n=E(()=>d.getClientById(y.params.id)),t=f({}),b=f({sent_bps:0,recv_bps:0,updated_at:null}),s=f(window.localStorage.getItem("wgdashboard_rate_unit")||"Mbps"),m=async()=>{await O("/api/clients/assignedPeers",{ClientID:n.value.ClientID},x=>{t.value=x.data})},k=async()=>{await O("/api/clients/realtimeUsage",{ClientID:n.value.ClientID},x=>{b.value=x.data||{sent_bps:0,recv_bps:0,updated_at:null}})},_=Z({Name:void 0}),B=x=>{const c=Number(x||0);return s.value==="MB/s"?`${(c/1e6).toFixed(2)} MB/s`:`${(c*8/1e6).toFixed(2)} Mbps`},W=x=>{s.value=x.target.value,window.localStorage.setItem("wgdashboard_rate_unit",s.value)};n.value?(ee(()=>n.value.ClientID,async()=>{_.Name=n.value.Name,await m(),await k(),j()}),[i,v]=V(()=>m()),await i,v(),[i,v]=V(()=>k()),await i,v(),_.Name=n.value.Name,j()):(p.push("/clients"),g.newMessage("WGDashboard","Client does not exist","danger"));const U=f(!1),Y=async()=>{U.value=!0,await K("/api/clients/updateProfileName",{ClientID:n.value.ClientID,Name:_.Name},x=>{x.status?(n.value.Name=_.Name,g.newMessage("Server","Client name update success","success")):(_.Name=n.value.Name,g.newMessage("Server","Client name update failed","danger")),U.value=!1})},H=async()=>{await p.push("/clients"),await d.getClients()},$=f(void 0),j=()=>{clearInterval($.value),$.value=setInterval(async()=>{await k()},5e3)};return te(()=>{clearInterval($.value),$.value=void 0}),(x,c)=>{const Q=G("RouterLink");return n.value?(l(),a("div",{class:"text-body d-flex flex-column overflow-y-scroll h-100",key:n.value.ClientID},[e("div",Oe,[e("div",Fe,[o(Q,{to:"/clients",class:"text-body text-decoration-none"},{default:z(()=>[...c[4]||(c[4]=[e("i",{class:"bi bi-arrow-left me-2"},null,-1),D(" Back",-1)])]),_:1})]),e("small",Ee,[o(r,{t:"Email"})]),e("h1",null,h(n.value.Email),1),e("div",ze,[e("div",Ge,[e("small",Te,[o(r,{t:"Client ID"})]),e("small",qe,[e("samp",null,h(n.value.ClientID),1)])]),e("div",Je,[e("small",Ke,[o(r,{t:"Client Name"})]),T(e("input",{class:"form-control form-control-sm rounded-3 ms-auto",style:{width:"300px"},type:"text","onUpdate:modelValue":c[0]||(c[0]=S=>_.Name=S)},null,512),[[q,_.Name]]),e("button",{onClick:c[1]||(c[1]=S=>Y()),"aria-label":"Save Client Name",class:"btn btn-sm rounded-3 bg-success-subtle border-success-subtle text-success-emphasis"},[...c[5]||(c[5]=[e("i",{class:"bi bi-save-fill"},null,-1)])])])])]),e("div",We,[e("div",Ye,[e("small",He,[o(r,{t:"Realtime Units"})]),e("select",{class:"form-select form-select-sm w-auto",onChange:W},[e("option",{value:"Mbps",selected:s.value==="Mbps"},"Mbps",8,Qe),e("option",{value:"MB/s",selected:s.value==="MB/s"},"MB/s",8,Xe)],32)]),e("div",Ze,[e("div",es,[e("div",ss,[e("div",ts,[e("small",ls,[o(r,{t:"Realtime Speed"})]),e("div",ns,h(B(b.value.recv_bps))+" ↓ ",1),e("div",as,h(B(b.value.sent_bps))+" ↑ ",1),e("div",is,[o(r,{t:"Updated"}),D(": "+h(b.value.updated_at||"—"),1)])])])])])]),e("div",os,[o(Be,{onRefresh:c[2]||(c[2]=S=>m()),clientAssignedPeers:t.value,client:n.value},null,8,["clientAssignedPeers","client"]),o(Ve,{onDeleteSuccess:c[3]||(c[3]=S=>H()),client:n.value},null,8,["client"])])])):(l(),a("div",rs,[e("div",ds,[c[6]||(c[6]=e("h1",null,[e("i",{class:"bi bi-person-x"})],-1)),e("p",null,[o(r,{t:"Client does not exist"})])])]))}}}),vs=le(cs,[["__scopeId","data-v-908c5d31"]]);export{vs as default};
