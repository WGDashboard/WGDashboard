import{_ as $,D as P,g as B,a as i,c as r,b as t,d as n,w as L,n as m,t as c,f as S,i as f,e as y,m as K,v as G,u as M,j as p,r as O,p as U,T as R,q as x,o as V,s as W,F as w,h as k,W as q,G as N,x as F}from"./index-Gbyk3iuC.js";import{L as v}from"./localeText-ClrYsr6Z.js";import{_ as j}from"./protocolBadge-BrUKpUEP.js";import{C as z}from"./storageMount.vue_vue_type_style_index_0_scoped_5d74c517_lang-8RA9abI7.js";const D={name:"configurationCard",components:{ProtocolBadge:j,LocaleText:v},props:{c:{Name:String,Status:Boolean,PublicKey:String,PrivateKey:String},delay:String,display:String},data(){return{configurationToggling:!1}},setup(){return{dashboardConfigurationStore:P()}},methods:{toggle(){this.configurationToggling=!0,B("/api/toggleWireguardConfiguration/",{configurationName:this.c.Name},e=>{e.status?this.dashboardConfigurationStore.newMessage("Server",`${this.c.Name} ${e.data?"is on":"is off"}`):this.dashboardConfigurationStore.newMessage("Server",e.message,"danger"),this.c.Status=e.data,this.configurationToggling=!1})}}},T=()=>{M(e=>({d75b06ae:e.delay}))},I=D.setup;D.setup=I?(e,s)=>(T(),I(e,s)):T;const J={class:"card conf_card rounded-3 shadow text-decoration-none"},E={class:"mb-0"},H={class:"card-title mb-0 d-flex align-items-center gap-2"},Y={class:"card-footer d-flex gap-2 flex-column"},A={class:"row"},Q={class:"d-flex gap-2 align-items-center"},X={class:"text-muted"},Z={class:"mb-0 d-block d-lg-inline-block"},tt={style:{"line-break":"anywhere"}},et={class:"form-check form-switch ms-auto"},st=["for"],ot={key:4,class:"spinner-border spinner-border-sm ms-2","aria-hidden":"true"},it=["disabled","id"];function at(e,s,o,_,a,g){const d=p("ProtocolBadge"),u=p("RouterLink"),l=p("LocaleText");return i(),r("div",{class:m(["col-12",{"col-lg-6 col-xl-4":this.display==="Grid"}])},[t("div",J,[n(u,{to:"/configuration/"+o.c.Name+"/peers",class:"card-body d-flex align-items-center gap-3 flex-wrap text-decoration-none"},{default:L(()=>[t("h6",E,[t("span",{class:m(["dot",{active:o.c.Status}])},null,2)]),t("h6",H,[t("samp",null,c(o.c.Name),1),t("small",null,[n(d,{protocol:o.c.Protocol,mini:!0},null,8,["protocol"])])]),s[2]||(s[2]=t("h6",{class:"mb-0 ms-auto"},[t("i",{class:"bi bi-chevron-right"})],-1))]),_:1},8,["to"]),t("div",Y,[t("div",A,[t("small",{class:m(["col-6",{"col-md-3":this.display==="List"}])},[s[3]||(s[3]=t("i",{class:"bi bi-arrow-down-up me-2"},null,-1)),S(c(o.c.DataUsage.Total>0?o.c.DataUsage.Total.toFixed(4):0)+" GB ",1)],2),t("small",{class:m(["text-primary-emphasis col-6",{"col-md-3":this.display==="List"}])},[s[4]||(s[4]=t("i",{class:"bi bi-arrow-down me-2"},null,-1)),S(c(o.c.DataUsage.Receive>0?o.c.DataUsage.Receive.toFixed(4):0)+" GB ",1)],2),t("small",{class:m(["text-success-emphasis col-6",{"col-md-3":this.display==="List"}])},[s[5]||(s[5]=t("i",{class:"bi bi-arrow-up me-2"},null,-1)),S(c(o.c.DataUsage.Sent>0?o.c.DataUsage.Sent.toFixed(4):0)+" GB ",1)],2),t("small",{class:m(["col-6",{"col-md-3 text-md-end ":this.display==="List"}])},[t("span",{class:m(["dot me-2",{active:o.c.ConnectedPeers>0}])},null,2),S(" "+c(o.c.ConnectedPeers)+" / "+c(o.c.TotalPeers)+" ",1),n(l,{t:"Peers"})],2)]),t("div",{class:m(["d-flex gap-2",[this.display==="Grid"?"flex-column":"gap-lg-3 flex-column flex-lg-row"]])},[t("div",Q,[t("small",X,[t("strong",null,[n(l,{t:"Public Key"})])]),t("small",Z,[t("samp",tt,c(o.c.PublicKey),1)])]),t("div",et,[t("label",{class:"form-check-label",style:{cursor:"pointer"},for:"switch"+o.c.PrivateKey},[!o.c.Status&&this.configurationToggling?(i(),f(l,{key:0,t:"Turning Off..."})):o.c.Status&&this.configurationToggling?(i(),f(l,{key:1,t:"Turning On..."})):o.c.Status&&!this.configurationToggling?(i(),f(l,{key:2,t:"On"})):!o.c.Status&&!this.configurationToggling?(i(),f(l,{key:3,t:"Off"})):y("",!0),this.configurationToggling?(i(),r("span",ot)):y("",!0)],8,st),K(t("input",{class:"form-check-input",style:{cursor:"pointer"},disabled:this.configurationToggling,type:"checkbox",role:"switch",id:"switch"+o.c.PrivateKey,onChange:s[0]||(s[0]=C=>this.toggle()),"onUpdate:modelValue":s[1]||(s[1]=C=>o.c.Status=C)},null,40,it),[[G,o.c.Status]])])],2)])])],2)}const rt=$(D,[["render",at],["__scopeId","data-v-6451623a"]]),nt={class:"text-muted me-2"},lt={class:"fw-bold"},ct={__name:"storageMount",props:{mount:String,percentage:Number,align:Boolean,square:Boolean},setup(e){M(a=>({"703ec95e":_.value}));const s=e,o=O(!1),_=U(()=>s.square?"40px":"25px");return(a,g)=>(i(),r("div",{class:"flex-grow-1 square rounded-3 border position-relative",onMouseenter:g[0]||(g[0]=d=>o.value=!0),onMouseleave:g[1]||(g[1]=d=>o.value=!1),style:x({"background-color":`rgb(25 135 84 / ${e.percentage}%)`})},[n(R,{name:"zoomReversed"},{default:L(()=>[o.value?(i(),r("div",{key:0,style:{"white-space":"nowrap"},class:m(["floatingLabel z-3 border position-absolute d-block p-1 px-2 bg-body text-body rounded-3 border shadow d-flex",[e.align?"end-0":"start-0"]])},[t("small",nt,[t("samp",null,c(e.mount),1)]),t("small",lt,c(e.percentage)+"% ",1)],2)):y("",!0)]),_:1})],36))}},dt=$(ct,[["__scopeId","data-v-5d74c517"]]),ut={class:"row text-body g-3 mb-5"},mt={class:"col-md-6 col-sm-12 col-xl-3"},gt={class:"d-flex align-items-center"},ht={class:"text-muted"},_t={class:"ms-auto"},ft={key:0},pt={key:1,class:"spinner-border spinner-border-sm"},yt={class:"progress",role:"progressbar",style:{height:"6px"}},bt={class:"d-flex mt-2 gap-1"},St={class:"col-md-6 col-sm-12 col-xl-3"},vt={class:"d-flex align-items-center"},xt={class:"text-muted"},wt={class:"ms-auto"},kt={key:0},Ct={key:1,class:"spinner-border spinner-border-sm"},Lt={class:"progress",role:"progressbar",style:{height:"6px"}},$t={class:"d-flex mt-2 gap-1"},Nt={class:"col-md-6 col-sm-12 col-xl-3"},Dt={class:"d-flex align-items-center"},Tt={class:"text-muted"},It={class:"ms-auto"},Pt={key:0},Bt={key:1,class:"spinner-border spinner-border-sm"},Kt={class:"progress",role:"progressbar",style:{height:"6px"}},Mt={class:"col-md-6 col-sm-12 col-xl-3"},Ut={class:"d-flex align-items-center"},Gt={class:"text-muted"},Ot={class:"ms-auto"},Rt={key:0},Vt={key:1,class:"spinner-border spinner-border-sm"},Wt={class:"progress",role:"progressbar",style:{height:"6px"}},qt={__name:"systemStatusWidget",setup(e){const s=P();let o=null;V(()=>{_(),o=setInterval(()=>{_()},5e3)}),W(()=>{clearInterval(o)});const _=()=>{B("/api/systemStatus",{},g=>{s.SystemStatus=g.data})},a=U(()=>s.SystemStatus);return(g,d)=>(i(),r("div",ut,[t("div",mt,[t("div",gt,[t("h6",ht,[d[0]||(d[0]=t("i",{class:"bi bi-cpu-fill me-2"},null,-1)),n(v,{t:"CPU"})]),t("h6",_t,[a.value?(i(),r("span",ft,c(a.value.cpu.cpu_percent)+"% ",1)):(i(),r("span",pt))])]),t("div",yt,[t("div",{class:"progress-bar",style:x({width:`${a.value?.cpu.cpu_percent}%`})},null,4)]),t("div",bt,[(i(!0),r(w,null,k(a.value?.cpu.cpu_percent_per_cpu,(u,l)=>(i(),f(z,{key:l,align:l+1>Math.round(a.value?.cpu.cpu_percent_per_cpu.length/2),core_number:l,percentage:u},null,8,["align","core_number","percentage"]))),128))])]),t("div",St,[t("div",vt,[t("h6",xt,[d[1]||(d[1]=t("i",{class:"bi bi-device-ssd-fill me-2"},null,-1)),n(v,{t:"Storage"})]),t("h6",wt,[a.value?(i(),r("span",kt,c(a.value?.disk["/"].percent)+"% ",1)):(i(),r("span",Ct))])]),t("div",Lt,[t("div",{class:"progress-bar bg-success",style:x({width:`${a.value?.disk["/"].percent}%`})},null,4)]),t("div",$t,[a.value?(i(!0),r(w,{key:0},k(Object.keys(a.value?.disk),(u,l)=>(i(),f(dt,{key:l,align:l+1>Math.round(Object.keys(a.value?.disk).length/2),mount:u,percentage:a.value?.disk[u].percent},null,8,["align","mount","percentage"]))),128)):y("",!0)])]),t("div",Nt,[t("div",Dt,[t("h6",Tt,[d[2]||(d[2]=t("i",{class:"bi bi-memory me-2"},null,-1)),n(v,{t:"Memory"})]),t("h6",It,[a.value?(i(),r("span",Pt,c(a.value?.memory.virtual_memory.percent)+"% ",1)):(i(),r("span",Bt))])]),t("div",Kt,[t("div",{class:"progress-bar bg-info",style:x({width:`${a.value?.memory.virtual_memory.percent}%`})},null,4)])]),t("div",Mt,[t("div",Ut,[t("h6",Gt,[d[3]||(d[3]=t("i",{class:"bi bi-memory me-2"},null,-1)),n(v,{t:"Swap Memory"})]),t("h6",Ot,[a.value?(i(),r("span",Rt,c(a.value?.memory.swap_memory.percent)+"% ",1)):(i(),r("span",Vt))])]),t("div",Wt,[t("div",{class:"progress-bar bg-warning",style:x({width:`${a.value?.memory.swap_memory.percent}%`})},null,4)])])]))}},Ft=$(qt,[["__scopeId","data-v-435b92ba"]]),jt={name:"configurationList",components:{SystemStatus:Ft,LocaleText:v,ConfigurationCard:rt},async setup(){return{wireguardConfigurationsStore:q()}},data(){return{configurationLoaded:!1,sort:{Name:N("Name"),Status:N("Status"),"DataUsage.Total":N("Total Usage")},currentSort:{key:"Name",order:"asc"},currentDisplay:"List",searchKey:""}},async mounted(){window.localStorage.getItem("ConfigurationListSort")?this.currentSort=JSON.parse(window.localStorage.getItem("ConfigurationListSort")):window.localStorage.setItem("ConfigurationListSort",JSON.stringify(this.currentSort)),window.localStorage.getItem("ConfigurationListDisplay")?this.currentDisplay=window.localStorage.getItem("ConfigurationListDisplay"):window.localStorage.setItem("ConfigurationListDisplay",this.currentDisplay),await this.wireguardConfigurationsStore.getConfigurations(),this.configurationLoaded=!0,this.wireguardConfigurationsStore.ConfigurationListInterval=setInterval(()=>{this.wireguardConfigurationsStore.getConfigurations()},1e4)},beforeUnmount(){clearInterval(this.wireguardConfigurationsStore.ConfigurationListInterval)},computed:{configurations(){return[...this.wireguardConfigurationsStore.Configurations].filter(e=>e.Name.toLowerCase().includes(this.searchKey)||e.PublicKey.includes(this.searchKey)||!this.searchKey).sort((e,s)=>this.currentSort.order==="desc"?this.dotNotation(e,this.currentSort.key)<this.dotNotation(s,this.currentSort.key)?1:this.dotNotation(e,this.currentSort.key)>this.dotNotation(s,this.currentSort.key)?-1:0:this.dotNotation(e,this.currentSort.key)>this.dotNotation(s,this.currentSort.key)?1:this.dotNotation(e,this.currentSort.key)<this.dotNotation(s,this.currentSort.key)?-1:0)}},methods:{dotNotation(e,s){let o=s.split(".").reduce((_,a)=>_&&_[a],e);return typeof o=="string"?o.toLowerCase():o},updateSort(e){this.currentSort.key===e?this.currentSort.order==="asc"?this.currentSort.order="desc":this.currentSort.order="asc":this.currentSort.key=e,window.localStorage.setItem("ConfigurationListSort",JSON.stringify(this.currentSort))},updateDisplay(e){this.currentDisplay!==e&&(this.currentDisplay=e,window.localStorage.setItem("ConfigurationListDisplay",this.currentDisplay))}}},zt={class:"mt-md-5 mt-3"},Jt={class:"container-fluid"},Et={class:"d-flex mb-4 configurationListTitle align-items-md-center gap-3 flex-column flex-md-row"},Ht={class:"text-body d-flex mb-0"},Yt={key:0,class:"text-body filter mb-3 d-flex gap-2 flex-column flex-md-row"},At={class:"d-flex align-items-center gap-3 align-items-center mb-3 mb-md-0"},Qt={class:"text-muted"},Xt={class:"d-flex ms-auto ms-lg-0"},Zt=["onClick"],te={class:"align-items-center gap-3 align-items-center mb-3 mb-md-0 d-none d-lg-flex"},ee={class:"text-muted"},se={class:"d-flex ms-auto ms-lg-0"},oe=["onClick"],ie={class:"d-flex align-items-center ms-md-auto"},ae={class:"row g-3 mb-2"},re={class:"text-muted col-12",key:"noConfiguration"};function ne(e,s,o,_,a,g){const d=p("SystemStatus"),u=p("LocaleText"),l=p("RouterLink"),C=p("ConfigurationCard");return i(),r("div",zt,[t("div",Jt,[n(d),t("div",Et,[t("h2",Ht,[n(u,{t:"WireGuard Configurations"})]),n(l,{to:"/new_configuration",class:"ms-md-auto py-2 text-decoration-none btn text-primary-emphasis bg-primary-subtle rounded-3 border-1 border-primary-subtle"},{default:L(()=>[s[1]||(s[1]=t("i",{class:"bi bi-plus-circle me-2"},null,-1)),n(u,{t:"Configuration"})]),_:1}),n(l,{to:"/restore_configuration",class:"py-2 text-decoration-none btn text-primary-emphasis bg-primary-subtle rounded-3 border-1 border-primary-subtle"},{default:L(()=>[s[2]||(s[2]=t("i",{class:"bi bi-clock-history me-2"},null,-1)),n(u,{t:"Restore"})]),_:1})]),this.configurationLoaded?(i(),r("div",Yt,[t("div",At,[t("small",Qt,[n(u,{t:"Sort By"})]),t("div",Xt,[(i(!0),r(w,null,k(this.sort,(h,b)=>(i(),r("a",{role:"button",onClick:le=>g.updateSort(b),class:m([{"bg-primary-subtle text-primary-emphasis":this.currentSort.key===b},"px-2 py-1 rounded-3"])},[t("small",null,[this.currentSort.key===b?(i(),r("i",{key:0,class:m(["bi me-2",[this.currentSort.order==="asc"?"bi-sort-up":"bi-sort-down"]])},null,2)):y("",!0),S(c(h),1)])],10,Zt))),256))])]),t("div",te,[t("small",ee,[n(u,{t:"Display as"})]),t("div",se,[(i(),r(w,null,k([{name:"List",key:"list"},{name:"Grid",key:"grid"}],h=>t("a",{role:"button",onClick:b=>g.updateDisplay(h.name),class:m([{"bg-primary-subtle text-primary-emphasis":this.currentDisplay===h.name},"px-2 py-1 rounded-3"])},[t("small",null,[t("i",{class:m(["bi me-2","bi-"+h.key])},null,2),S(" "+c(h.name),1)])],10,oe)),64))])]),t("div",ie,[s[3]||(s[3]=t("label",{for:"configurationSearch",class:"text-muted"},[t("i",{class:"bi bi-search me-2"})],-1)),K(t("input",{class:"form-control form-control-sm rounded-3","onUpdate:modelValue":s[0]||(s[0]=h=>this.searchKey=h),id:"configurationSearch"},null,512),[[F,this.searchKey]])])])):y("",!0),t("div",ae,[this.configurationLoaded&&this.wireguardConfigurationsStore.Configurations.length===0?(i(),r("p",re,[n(u,{t:"You don't have any WireGuard configurations yet. Please check the configuration folder or change it in Settings. By default the folder is /etc/wireguard."})])):this.configurationLoaded?(i(!0),r(w,{key:1},k(g.configurations,(h,b)=>(i(),f(C,{display:this.currentDisplay,delay:b*.05+"s",key:h.Name,c:h},null,8,["display","delay","c"]))),128)):y("",!0)])])])}const ge=$(jt,[["render",ne],["__scopeId","data-v-c901839e"]]);export{ge as default};
