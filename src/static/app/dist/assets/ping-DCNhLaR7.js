import{_ as R,D as C,r as v,y as P,g as S,c as o,b as e,d as n,m as p,B as k,F as m,h as g,e as f,x as w,t as d,w as h,T as I,i as T,S as A,k as M,a as i,f as L,n as O,j as x}from"./index-CgM9eUIs.js";import{L as V}from"./localeText-Dh33930I.js";import{O as B,a as U,l as $}from"./osmapSocket-CJmzPMGM.js";const D={name:"ping",components:{OsmapSocket:B,OSMap:U,LocaleText:V},data(){return{loading:!1,cips:{},selectedConfiguration:void 0,selectedPeer:void 0,selectedIp:void 0,pingResult:void 0}},setup(){const u=C();let t;const _=v({pingTotalSentCount:0,pingReceivedSentCount:0,pingLostCount:0,pingResults:[]}),r=v(4),c=v(!1);try{t=$(),t.connect(),console.info("Successfully connected to socket.io")}catch{console.assert("Failed to connect socket.io")}return t.on("pingResponse",(...b)=>{let l=b[0];l.status&&c.value?(l.data.id=P().toString(),_.value.pingResults.push(l.data)):(u.newMessage("Server",l.message,"danger"),c.value=!1)}),t.on("pingResponseEnd",()=>{c.value=!1}),{store:u,sio:t,socketResult:_,count:r,pinging:c}},beforeUnmount(){this.sio&&this.sio.connected&&(this.sio.disconnect(),console.info("Successfully disconnected from socket.io"))},mounted(){S("/api/ping/getAllPeersIpAddress",{},u=>{u.status&&(this.loading=!0,this.cips=u.data)})},methods:{executeSocket(){this.sio.connected&&(this.socketResult.pingResults=[],this.pinging=!0,this.sio.emit("ping",{ipAddress:this.selectedIp,count:this.count}))}},watch:{selectedConfiguration(){this.selectedPeer=void 0,this.selectedIp=void 0},selectedPeer(){this.selectedIp=void 0}}},F={class:"mt-md-5 mt-3 text-body"},N={class:"container"},E={class:"row"},G={class:"col-sm-4 d-flex gap-2 flex-column"},j={class:"mb-1 text-muted",for:"configuration"},z=["disabled"],H=["value"],q={class:"mb-1 text-muted",for:"peer"},J=["disabled"],K=["value"],Q={class:"mb-1 text-muted",for:"ip"},W=["disabled"],X={class:"d-flex align-items-center gap-2"},Y={class:"text-muted"},Z={class:"mb-1 text-muted",for:"ipAddress"},ee=["disabled"],se={class:"mb-1 text-muted",for:"count"},te={class:"d-flex gap-3 align-items-center"},le=["disabled"],ne=["disabled"],ie={key:0,class:"d-block"},oe={key:1,class:"d-block"},de={class:"col-sm-8 position-relative d-flex flex-column gap-2 animate__fadeIn animate__animated"},ae={key:"pingResultTable"},ue={key:"table",class:"w-100 mt-2"},ce={class:"table table-sm rounded-3 w-100"},re={scope:"col"},pe={scope:"col"},me={scope:"col"},ge={scope:"col"},fe={key:0},he={key:0},_e={colspan:"4",class:"text-muted text-center"},be={class:"bg-body-tertiary border-top fw-bold",style:{"border-top":"2px solid !important"}},ve={colspan:"2"},ke={class:""},xe={class:""},ye={class:""},Re={colspan:"2"},Ce={key:0},Pe={key:1};function Se(u,t,_,r,c,b){const l=x("LocaleText"),y=x("OsmapSocket");return i(),o("div",F,[e("div",N,[t[18]||(t[18]=e("h3",{class:"mb-3 text-body"},"Ping",-1)),e("div",E,[e("div",G,[e("div",null,[e("label",j,[e("small",null,[n(l,{t:"Configuration"})])]),p(e("select",{class:"form-select","onUpdate:modelValue":t[0]||(t[0]=s=>this.selectedConfiguration=s),disabled:this.pinging},[t[7]||(t[7]=e("option",{disabled:"",selected:"",value:void 0},null,-1)),(i(!0),o(m,null,g(this.cips,(s,a)=>(i(),o("option",{value:a},d(a),9,H))),256))],8,z),[[k,this.selectedConfiguration]])]),e("div",null,[e("label",q,[e("small",null,[n(l,{t:"Peer"})])]),p(e("select",{id:"peer",class:"form-select","onUpdate:modelValue":t[1]||(t[1]=s=>this.selectedPeer=s),disabled:this.selectedConfiguration===void 0||this.pinging},[t[8]||(t[8]=e("option",{disabled:"",selected:"",value:void 0},null,-1)),this.selectedConfiguration!==void 0?(i(!0),o(m,{key:0},g(this.cips[this.selectedConfiguration],(s,a)=>(i(),o("option",{value:a},d(a),9,K))),256)):f("",!0)],8,J),[[k,this.selectedPeer]])]),e("div",null,[e("label",Q,[e("small",null,[n(l,{t:"IP Address"})])]),p(e("select",{id:"ip",class:"form-select","onUpdate:modelValue":t[2]||(t[2]=s=>this.selectedIp=s),disabled:this.selectedPeer===void 0||this.pinging},[t[9]||(t[9]=e("option",{disabled:"",selected:"",value:void 0},null,-1)),this.selectedPeer!==void 0?(i(!0),o(m,{key:0},g(this.cips[this.selectedConfiguration][this.selectedPeer].allowed_ips,s=>(i(),o("option",null,d(s),1))),256)):f("",!0)],8,W),[[k,this.selectedIp]])]),e("div",X,[t[10]||(t[10]=e("div",{class:"flex-grow-1 border-top"},null,-1)),e("small",Y,[n(l,{t:"OR"})]),t[11]||(t[11]=e("div",{class:"flex-grow-1 border-top"},null,-1))]),e("div",null,[e("label",Z,[e("small",null,[n(l,{t:"Enter IP Address / Hostname"})])]),p(e("input",{class:"form-control",type:"text",id:"ipAddress",disabled:this.pinging,"onUpdate:modelValue":t[3]||(t[3]=s=>this.selectedIp=s)},null,8,ee),[[w,this.selectedIp]])]),t[16]||(t[16]=e("div",{class:"w-100 border-top my-2"},null,-1)),e("div",null,[e("label",se,[e("small",null,[n(l,{t:"Count"})])]),e("div",te,[e("button",{onClick:t[4]||(t[4]=s=>this.count--),disabled:this.count===1,class:"btn btn-sm bg-secondary-subtle text-secondary-emphasis"},t[12]||(t[12]=[e("i",{class:"bi bi-dash-lg"},null,-1)]),8,le),e("strong",null,d(this.count),1),e("button",{role:"button",onClick:t[5]||(t[5]=s=>this.count++),class:"btn btn-sm bg-secondary-subtle text-secondary-emphasis"},t[13]||(t[13]=[e("i",{class:"bi bi-plus-lg"},null,-1)]))])]),e("button",{class:"btn btn-primary rounded-3 mt-3 position-relative",disabled:!this.selectedIp||this.pinging,onClick:t[6]||(t[6]=s=>this.executeSocket())},[n(I,{name:"slide"},{default:h(()=>[this.pinging?(i(),o("span",oe,t[15]||(t[15]=[e("span",{class:"spinner-border spinner-border-sm","aria-hidden":"true"},null,-1),e("span",{class:"visually-hidden",role:"status"},"Loading...",-1)]))):(i(),o("span",ie,t[14]||(t[14]=[e("i",{class:"bi bi-person-walking me-2"},null,-1),L("Ping! ")])))]),_:1})],8,ne)]),e("div",de,[(i(),T(A,null,{fallback:h(()=>t[17]||(t[17]=[e("div",{class:"bg-body-secondary rounded-3 mb-3 d-flex",key:"OSMapPlaceholder",style:{height:"300px"}},[e("div",{class:"spinner-border m-auto",style:{"animation-duration":"2s"},role:"status"},[e("span",{class:"visually-hidden"},"Loading...")])],-1)])),default:h(()=>[n(y,{d:this.socketResult.pingResults,key:"OSMap",type:"traceroute"},null,8,["d"])]),_:1})),e("div",ae,[e("div",ue,[e("table",ce,[e("thead",null,[e("tr",null,[e("th",re,[n(l,{t:"IP Address"})]),e("th",pe,[n(l,{t:"Is Alive?"})]),e("th",me,[n(l,{t:"RTT"})]),e("th",ge,[n(l,{t:"Geolocation"})])])]),e("tbody",null,[n(M,{name:"ping"},{default:h(()=>[(i(!0),o(m,null,g(r.socketResult.pingResults,s=>(i(),o("tr",{key:s.id},[e("td",null,[e("small",null,d(s.address),1)]),e("td",null,[e("small",null,[e("i",{class:O(["bi",[s.is_alive?"bi-check-circle-fill text-success":"bi-x-circle-fill text-danger"]])},null,2)])]),e("td",null,[e("small",null,d(s.is_alive?s.max_rtt:""),1)]),e("td",null,[s.geo&&s.geo.status==="success"?(i(),o("small",fe,d(s.geo.city)+", "+d(s.geo.country),1)):f("",!0)])]))),128))]),_:1}),r.socketResult.pingResults.length===0?(i(),o("tr",he,[e("td",_e,[e("small",null,[n(l,{t:"Ping results will show here"})])])])):f("",!0),e("tr",be,[e("td",null,[e("small",null,[n(l,{t:"Sent Package(s)"})])]),e("td",null,[e("small",null,[n(l,{t:"Received Package(s)"})])]),e("td",null,[e("small",null,[n(l,{t:"Lost Package(s)"})])]),e("td",ve,[e("small",null,[n(l,{t:"Average / Min / Max Round Trip Time"})])])]),e("tr",null,[e("td",ke,[e("small",null,d(this.socketResult.pingResults.length),1)]),e("td",xe,[e("small",null,d(this.socketResult.pingResults.filter(s=>s.is_alive).length),1)]),e("td",ye,[e("small",null,d(this.socketResult.pingResults.filter(s=>!s.is_alive).length),1)]),e("td",Re,[this.socketResult.pingResults.filter(s=>s.is_alive).length>0?(i(),o("small",Ce,d((this.socketResult.pingResults.filter(s=>s.is_alive).map(s=>s.max_rtt).reduce((s,a)=>s+a)/this.socketResult.pingResults.filter(s=>s.is_alive).length).toFixed(3))+"ms / "+d(Math.min(...this.socketResult.pingResults.filter(s=>s.is_alive).map(s=>s.max_rtt)))+"ms / "+d(Math.max(...this.socketResult.pingResults.filter(s=>s.is_alive).map(s=>s.max_rtt)))+"ms ",1)):(i(),o("small",Pe," 0ms / 0ms / 0ms "))])])])])])])])])])])}const Ae=R(D,[["render",Se],["__scopeId","data-v-47f01fbc"]]);export{Ae as default};
